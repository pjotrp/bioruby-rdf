# Template for generating RDF triples from COSMIC mution data
#
#   env INFILE=CosmicMutantExportIncFus_v68.txt erb cosmic_mutant_export.rdf
#
<%= File.read(File.dirname(__FILE__)+'/preamble.rdf')  %>
<%
   File.open(ENV["INFILE"]).each_line do |line|
     fields = line.split(/\t/)
     next if fields.first == 'Gene name'
     next if fields[13] == ''
     if fields[10] !~ /silent/
       gene = fields[0].split(/_/).first
       (chr,pos1) = fields[13].split(/:/) if fields[13]
       next if not pos1
       pos2 = pos1.split(/-/)
       next if not pos2
       pos = pos2[0]
       cosmicid = fields[7]
       nuc = fields[8]
       ref = nuc[-3]
       alt = nuc[-1]
       descr = fields[3]
       breast_cancer = true if descr =~ /breast/
       cancer = true 
       id = 'cosmic'+cosmicid+'_'+chr+'_'+pos
%>
  :<%= id %>  seq:chr         "<%= chr %>" .
  :<%= id %>  seq:pos         <%= pos %> .
  :<%= id %>  seq:ref         "<%= ref %>" .
  :<%= id %>  seq:alt         "<%= alt %>" .
  :<%= id %>  seq:gene_name   "<%= gene %>" .
  :<%= id %>  db:id        db:cosmic .
  :<%= id %>  cosmic:id      "COSM<%= cosmicid %>" .
  :<%= id %>  cosmic:nuc_mutation    "<%= nuc %>" .
  :<%= id %>  cosmic:aa_mutation    "<%= fields[9] %>" .
  :<%= id %>  annotate:cancer         true .
  <% if breast_cancer %>:<%= id %>  annotate:breast_cancer  true .<% end %>
  :<%= id %>  cosmic:sample      "<%= fields[2] %>" .
  :<%= id %>  cosmic:descr       "<%= fields[11]+' '+fields[10] %>" .
  :<%= id %>  disease:descr      "<%= descr %> cancer" .
  <% if fields[6]!='' and fields[6]!='NS' %>
  :<%= id %>  cosmic:subtype "<%= fields[6] %>" .
  <% end %>
  <% if fields[15] %>
  :<%= id %>  :pmid "<%= fields[15] %>" .
  <% end %>
<%  end 
  end %>
