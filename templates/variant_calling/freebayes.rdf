# Template for generating RDF triples from freebayes data
#
#   bio-vcf --filter rec.info.geneinfo --eval '[rec.id,rec.chr,rec.pos,rec.info.sao,rec.info.CLNDBN,rec.info.geneinfo.split(/:/)[0]].join("\t")' < /export/data/MBC/clinvar_20140303.vcf > /export/data/MBC/clinvar_20140303.tab
#   
#   bio-vcf -v --eval 'fields[0..4]+[r.info.sample[0..5]]' --seval 's.dp' < germline_freebayes.vcf
#
# resulting in
#
#   10      101964404       .       G       A       MBC012R 20      18
#   10      101977883       .       C       T       MBC003R 4       13
#   (...)
#   
# followed by
#
#   env INFILE=table.txt erb freebayes.rdf
#

@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix hgnc: <http://identifiers.org/hgnc.symbol/> .
@prefix seq: <http://biobeat.org/rdf/seq#> .
@prefix db: <http://biobeat.org/rdf/db#> .
@prefix disease: <http://biobeat.org/rdf/disease#> .
@prefix mbc: <http://biobeat.org/rdf/mbc#> .
@prefix : <http://biobeat.org/rdf/freebayes#> .

<%
   variant_type = if ENV["INFILE"] =~ /germl/
                    'germline'
                  else
                    'somatic'
                  end
   File.open(ENV["INFILE"]).each_line do |line|
     next if line =~ /^(#|Chr)/
     fields = line.split(/\t/)
     chr = fields[0]
     pos = fields[1]
     ref = fields[3]
     alt = fields[4]
     sample = fields[5]
     id = 'freebayes_'+chr+'_'+pos+'_'+sample
%>
  :<%= id %>  seq:chr         "<%= chr %>" .
  :<%= id %>  seq:pos         <%= pos %> .
  :<%= id %>  :id          "<%= id %>" .
  :<%= id %>  seq:variant_type :<%= variant_type %> .
  :<%= id %>  seq:ref         "<%= ref %>" .
  :<%= id %>  seq:alt         "<%= alt %>" .
  :<%= id %>  mbc:sample      "<%= sample %>" .
  :<%= id %>  db:id         db:freebayes .
<% end %>
