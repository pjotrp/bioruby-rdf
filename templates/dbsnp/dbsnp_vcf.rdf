# Template for generating RDF triples from dbsnp VCF 
#
# First convert VCF to a table with, e.g.,
#
#   bio-vcf --eval '[rec.id,rec.chr,rec.pos,rec.alt,rec.info.sao,rec.info.CLNDBN].join("\t")' < clinvar_20140303.vcf > clinvar_20140303.tab
#
# followed by
#
#   env INFILE=clinvar_20140303.tab erb dbsnp_vcf.rdf
#
<%= File.read(File.dirname(__FILE__)+'/preamble.rdf')  %>
<%
   File.open(ENV["INFILE"]).each_line do |line|
     fields = line.split(/\t/)
     snpid = fields[0]
     chr = fields[1]
     pos = fields[2]
     sao = fields[3]
     descr = fields[4].strip
     type = case sao
              when '1' then 'germline'
              when '2' then 'somatic'
              when '3' then 'germline_somatic'
              else
                nil
            end

     id = 'dbsnp_'+snpid+'_'+chr+'_'+pos
%>
  :<%= id %>  :chr         "<%= chr %>" .
  :<%= id %>  :pos         <%= pos %> .
  :<%= id %>  :snpid       "<%= snpid %>" .
  :<%= id %>  :descr       "<%= descr %>" .
  <% if type %>
  :<%= id %>  :type        :<%= type %> .
  <% end %>
<% end %>
